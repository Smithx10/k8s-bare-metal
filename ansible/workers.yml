---
- hosts: workers
  become_user: root
  become: true
  remote_user: root
  tasks:
  - name: make directory for Kubernetes
    file: path=/var/lib/kubernetes state=directory
  - name: make directory for provider configs
    file: path=/etc/kubernetes state=directory
  - name: make directory for kubelet config
    file: path=/var/lib/kubelet state=directory
  - name: upload CA certificate pem
    copy:
      src: ../output/ca.pem
      dest: /var/lib/kubernetes
      owner: root
      group: root
      mode: 0644
  - name: upload Kubernetes certificate pem
    copy:
      src: ../output/kubernetes.pem
      dest: /var/lib/kubernetes
      owner: root
      group: root
      mode: 0644
  - name: upload Kubernetes key pem
    copy:
      src: ../output/kubernetes-key.pem
      dest: /var/lib/kubernetes
      owner: root
      group: root
      mode: 0600
  - name: upload kubelet.service systemd unit
    copy:
      src: ../templates/kubelet.service
      dest: /etc/systemd/system
      owner: root
      group: root
      mode: 0600
  - name: upload kube-proxy.service systemd unit
    copy:
      src: ../templates/kube-proxy.service
      dest: /etc/systemd/system
      owner: root
      group: root
      mode: 0600
  - name: upload start-kubelet.sh script
    copy:
      src: ../output/start-kubelet.sh
      dest: /usr/local/sbin
      owner: root
      group: root
      mode: 0500



